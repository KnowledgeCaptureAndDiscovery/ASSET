<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">


<dom-module id="interactive-table">
  <template>
    <style>
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
      }

      td, th {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
      }

      tr:nth-child(even) {
        background-color: #dddddd;
      }

      #title, button {
        float: left;
      }
    </style>
    <h2 id="title">[[elementTitle]]</h2>
    
    <table>
        <template is="dom-repeat" items="{{details}}">
            <tr class = "descriptionRow">
            <td contenteditable="true" on-focus = "focusing" on-blur="onBlur" class = "name" id ="name[[index]]" on-keypress="save">[[item.name]]</td>
            <td contenteditable="true" on-focus = "focusing" on-blur="onBlur" class = "detail" id ="detail[[index]]" on-keypress="save">[[item.detail]]</td>
          </tr>
        </template>
    </table>

    <br>
    <button on-click= "addNewProperty">Add property</button>
    
  </template>

  <script>
    
    /**
     * `interactive-table`
     * 
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class InteractiveTable extends Polymer.Element {
      static get is() { return 'interactive-table'; }
      static get properties() {
        return {
          elementTitle : {
            type: String,
            value: ""
          }
          ,
          details: {
            type: Array,
            value() {
              return [];
            }
          }
          ,
          next : {
            type: Array,
            value: []
          }
          ,
          detail : { //0 if name, 1 if detail
            type: Number,
            value: null
          }
          ,
          focus : {
            type: Boolean,
            value : false
          }
        };
      }

      addNewProperty() {
        this.push("details", {name: "", detail: ""});
      }

      addProperty(theName, theDetail) {
        this.push("details", {name: theName, detail: theDetail});
      }

      editName(title) {
        this.elementTitle = title;
      }

      focusing() {
        this.focus = true;
      }

      onBlur(e) {
        this.save(e);
        this.focus = false;
      }
      save(e) {
        if (e.target.className == "name") {
          this.details[parseInt(e.target.id.substring(4))]["name"] = e.target.innerHTML;
          this.detail = 0;
        } else if(e.target.className == "detail") {
          this.details[parseInt(e.target.id.substring(6))]["detail"] = e.target.innerHTML;
          this.detail = 1;
        } else {
          if (this.detail === 1) {
            this.details[parseInt(e.target.id.substring(6))]["detail"] = e.target.innerHTML;
          } else if (this.detail === 0) {
            this.details[parseInt(e.target.id.substring(4))]["name"] = e.target.innerHTML;
          }
        }
      }

      loadDetails(details) {
        this.details = details;
      }

      clear() {
        this.focus = false;
        this.details = null;
      }
    }

    window.customElements.define(InteractiveTable.is, InteractiveTable);
  </script>
</dom-module>
